conversation CoffeeShop;

participant rick {
    name: Rick
}

participant brian {
    name: "Brian"
}


starting topic welcome {
    starting beat intro {
        seq {
            node {speaker: rick, text: "Hey there"}
            node {speaker: rick, text: "I bought you a latte, but it's a bit cold now." set just_bought_coffee=1 clear beat;}

            op {
                beat break
                seq {
                    node {speaker: brian, text:"..." set sullen++;}
                    topic break
                }
            }
        }
    }

    beat reaction {
        op {
            seq sorry {
                node {speaker: brian, text:"yeah, sorry about that" set apologetic++;}
                node {speaker: rick, text:"no worries"}
                op{beat break, topic break}
            }
            seq {
                node {speaker: brian, text:"how long were you waiting?"}
                node {speaker: rick, text:"oh not too long."}
                node {speaker: rick, text:"just a minute or two."}
                op {&sorry, beat break, topic break}
            }
        }
    }

    beat coffee {
        op {
            seq {
                node {when !just_bought_coffee speaker: brian, text: "so anyway,"}
                &what_kind_of_latte // <-- initiates this node
            }

            seq what_kind_of_latte {
                node {speaker: brian, text: "what kind of latte did you get me?"}
                node {speaker: rick, text: "it's one of their seasonal specials. It sounded extremely noxious and sweet, I thought you would love it."}
                op {
                    node {speaker: brian, text: "*sip* mmm, delicious", set cheerful++;}
                    node {speaker: brian, text: "you know me so well!", set congenial++;}
                    op {beat break, topic break}
                }
            }

            seq {
                node {when just_bought_coffee speaker: brian, text: "aww, you shouldn't have!" set cheerful++;}
                op {&what_kind_of_latte, beat break, topic break}
            }
        }
    }
}

topic miscellaneous_smalltalk {
    starting beat {
        seq {
            node {speaker: rick, text:"so... how are you?"}
            op{
                node {speaker: brian, text:"not too bad"} // generic non-answer
                node {speaker: brian, text:"pretty good, actually", set cheerful++; positivity++;}
                node {speaker: brian, text:"eenh, things are okay", set cheerful--;}
                node {speaker: brian, text:"not great", set positivity--; cheerful--; sullen++;}
            }
        }
    }
    starting beat {
        seq {
            node {speaker: rick, text:"been up to anything exciting?"}
        }
    }

    beat {
        //mood response 1
        // rick speaks, reacting to brian’s mood
        when sullen
        op {
            node {speaker: rick, text:"What’s wrong?"}
        }
    }
}